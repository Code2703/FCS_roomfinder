{% extends 'layout.html' %}



{% block title %}
Home
{% endblock %}



{% block main %}

  
<div class="container text-center" style="padding: 20px;">
    <h3>You need space? We've got rooms!</h3>
    <p>Discovering the perfect study sanctuary on campus is now effortlessly at your fingertips! 
        Simply input your preferred maximum room size for a comfortable experience, along with the 
        date and time, and let UniSG Roomfinder unveil all the available quiet spaces tailored just for you. 
        Elevate your study sessions with ease and precision! ðŸ“šâœ¨
    </p>
</div>


<div class="container text-center">
    <div class="row align-items-start">

        <!-- Filters Column -->
        <div class="col">
            <div>
                <form action="" method="post" novalidate>
                    
                    <!-- Filter by date -->
                    <label for="start" class="form-label" style="margin-top: 10px;">Date:</label>
                    <input type="date" class="form-control" name="filter_date" value="{{ filter_date }}" min="{{ min_date }}" max="{{ max_date }}" required>
                    <div class="valid-feedback">
                        Looks good!
                    </div>
                    
                    <!-- Filter by start time -->
                    <label for="start_time" class="form-label" style="margin-top: 10px;">From:</label>
                    <input type="time" class="form-control" name="filter_time" value="{{ filter_time }}" min="{{ min_time }}" max="{{ max_time }}" required>
                    <div class="valid-feedback">
                        Looks good!
                    </div>
                    
                    <!-- Filter by end time -->
                    <label for="start_time" class="form-label" style="margin-top: 10px;">To:</label>
                    <input type="time" class="form-control" name="filter_end_time" value="{{ filter_end_time }}" min="{{ min_end_time }}" max="{{ max_end_time }}" required>
                    <div class="valid-feedback">
                        Looks good!
                    </div>
                    
                    <!-- Enter nearest room for routing directions -->
                    <div class="form-group" style="margin-top: 10px;">
                        <label for="start_location">My location:</label>
                        <input class="form-control" list="location_list" id="start_location" name="start_location" />
                    </div>
                    <datalist id="location_list">
                        {% for index, row in start_locations.iterrows() %}
                            <option value="{{ row['room_nr'] }}"></option>
                        {% endfor %}
                    </datalist>

                    <!-- Select by size -->
                    <label for="validationCustom01" class="form-label" style="margin-top: 10px;">Max. Room Size:</label>
                    <input type="text" class="form-control" name="filter_size" value="{{ filter_size if not filter_size_is_inf else '' }}" required>
                    <div class="valid-feedback">
                        Looks good!
                    </div>

                    <!-- Filter by room
                    <label for="room_selector" class="form-label" style="margin-top: 10px;">Select a room:</label>
                    <select class="form-select" name="room_selector" aria-label="Default select example">
                        <option selected>Coming Soon!</option>
                        {% for index, row in rooms_df.iterrows() %}
                        <option value="1">Room: {{ row['room_nr'] }}</option>
                        {% endfor %}
                    </select> -->
                    

                    <!-- Filter by availability
                    <div class="form-check" style="margin-top: 20px;">
                        <input class="form-check-input" type="checkbox" value="" name="filter_available" required>
                        <label class="form-check-label" for="filter_available">
                            Only show available rooms
                        </label>
                    </div> -->
             
                    <!-- Submit the form -->
                    <div class="col">
                        <button class="btn btn-primary" type="submit" name="button_filter_size" style="margin: 10px; width: 80px;">Search</button>
                    </div>
                </form>
                
                <!-- Button to clear all filters -->
                
                <div>
                    <form action="{{ url_for('clear_filters') }}" method="post">
                        <button type="submit" class="btn btn-secondary" style="margin: 10px; width: 80px;">Clear</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Rooms Column -->
        <div class="col-12 col-sm-9">
            {% for index, row in rooms_df.iterrows() %}
                <div class="card" style="margin: 20px;">
                    <div class="card-header">
                        {{ row['infoUrlText'] if row['infoUrlText'] == 'Group meeting room' else row['name'] }}
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">Room: {{ row['room_nr'] }}</h5>
                        <p class="card-text">
                            <Div>
                                {% if row['seats'] == None %}
                                    Size: -
                                {% else %}
                                    Size: {{ row['seats'] }}
                                {% endif %}
                            </Div>
                            <div>
                                {% if row['start_time'].strftime('%Y-%m-%d %H:%M:%S') != '1970-01-01 00:00:00' %}
                                    Free until: {{ row['start_time'].strftime('%H:%M') }}
                            </div>
                            <div> 
                                    Next Event: {{ row['subject'] }} ({{ row['start_time'].strftime('%H:%M') }} - {{ row['end_time'].strftime('%H:%M') }})
                                {% else %}
                                    {{ row['subject'] }}
                                {% endif %}
                            </div>
                        </p>
                        
                        <button class="btn btn-primary" type="button" onclick="redirectToRoomDetails('{{ row['room_nr'] }}')">More Details</button>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
<script>
    function redirectToRoomDetails(roomNr) {
        window.location.href = '/map?room_nr=' + roomNr;
    }
</script>    
{% endblock %}